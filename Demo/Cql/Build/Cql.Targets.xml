<?xml version="1.0" encoding="utf-8" ?>
<Project>
	<PropertyGroup>
		<!-- If you change the version here, you also need to update it in the pom.xml file -->
		<CqlToElmCliVersion>3.1.0</CqlToElmCliVersion>
	</PropertyGroup>

	<ItemGroup>
		<ElmFiles Include="$(SolutionDir)\LibrarySets\Demo\Cql\*.json" />
		<ElmFiles Include="$(SolutionDir)\LibrarySets\CMS\Cql\*.json" />
	</ItemGroup>

	<Target Name="Download CQL to ELM CLI via Maven" Inputs="Build\pom.xml" Outputs="Build\target\dependency\cql-to-elm-cli-$(CqlToElmCliVersion).jar">
		<Exec Command="mvn -f Build\pom.xml dependency:copy-dependencies" />
	</Target>
	<Target Name="CQL to ELM"
			DependsOnTargets="Download CQL to ELM CLI via Maven"
			AfterTargets="Build">
		<Message Text="Converting CQL to ELM"/>
		<Exec Command='java -classpath "$(MSBuildProjectDirectory)\Build\target\dependency\*" org.cqframework.cql.cql2elm.cli.Main -input "$(SolutionDir)\LibrarySets\Demo\Cql" -f JSON -output "$(SolutionDir)\LibrarySets\Demo\Elm" -locators true -result-types true -signatures All'/>
		<Exec Command='java -classpath "$(MSBuildProjectDirectory)\Build\target\dependency\*" org.cqframework.cql.cql2elm.cli.Main -input "$(SolutionDir)\LibrarySets\CMS\Cql" -f JSON -output "$(SolutionDir)\LibrarySets\CMS\Elm" -locators true -result-types true -signatures All'/>
	</Target>
	<Target Name="Delete ELM" AfterTargets="Clean">
		<Message Text="Deleting ELM files..." />
		<Delete Files="@(ElmFiles)" />
	</Target>
</Project>